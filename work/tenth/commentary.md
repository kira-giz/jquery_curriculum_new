# jQuery10

## 機能
- 検索
- ページング

---

## 変数
### 外部変数
- rakutenBooks
  - 通信時のパラメーター
- PAGE_COUNT
  - 総ページ数
  - 外部からのアクセス用
    - bookSearch
    - insertPager
    - paging
- canAjax
  - falseの場合何も返さない=通信しない
  - alwaysで成否に関わらずtrueに戻し再度通信できるような状態にする

### DOM
- lists
  - 検索結果を挿入
- message
  - エラーメッセージと検索結果0件を挿入
- searchBtn
  - 検索ボタン

---

## イベント
### 検索ボタンクリック
- 検索ワードの取得
  - 検索ワードの有無で分岐
- 無（未入力）
  - エラーメッセージの挿入
- 有
  - 検索関数実行

### ページャー
- aタグのhrefのイベントを打ち消し
- paging関数実行

---

## 関数
### bookSearch
- domReset関数の実行
  - DOMを挿入する為既存のDOMをリセットする
- 検索ワードの取得
- Ajax通信
  - 引数のparamsをdataとして送信する
- done
  - 総ページ数と取得データ配列を取得
  - **分岐**
    - 取得データ0件（検索結果0）
      - messageに文字列挿入
    - 1件以上
      - 取得した配列の分だけループでDOMを生成(nestList)
      - 全てのDOMを挿入し終えた後にページャーを挿入(insertPager)
- fail
  - エラーメッセージをコンソールに表示

### domReset
- 新しくDOMを生成する為にlistsとmessageの中身は空に
- pagerは削除

### nestList
- 引数には本の情報
- listsにネストするDOMを生成

### insertPager
- NOW_PAGE 現在ページを取得
- ページャーの挿入
- 場合わけによりページャーを活性 / 非活性
  - 総ページが１ページ
  - 総ページが2以上で現在ページが１
  - 総ページが2以上で現在ページと総ページの数が等しい

### paging
- 引数にイベント
- イベント対象と対象のデータ属性を取得
- 現在のページ取得
- データ属性の値によってswitchで分岐
  - 理由: ケースが２パターンと限られていて、2パターンの中でも分岐が発生するから。
  - prev押下
    - 現在のページが1の時何も返さない
    - 2以上の時現在のページから1引いてbookSearch関数
  - next押下
    - 現在のページが100ページ目または現在のページと総ページ数が同じ時何も返さない
    - それ以外のケースでページに1足してbookSearch関数
## ページャーdisabled

### どちらも
- 総ページ数が１ページしかない時

### 前へ
- 総ページ数が２以上かつ１ページ目

### 次へ
- 総ページ数が１じゃなくてかつ総ページ数と現ページが同じ時